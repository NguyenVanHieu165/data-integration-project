{
  "dat_hang": [
    {
      "name": "fk_customer_exists",
      "query": "SELECT COUNT(*) as cnt FROM staging.khach_hang_tbl WHERE id = ?",
      "params_from_row": ["customer_id"],
      "validation": "result[0]['cnt'] > 0 if result else False",
      "error_message": "customer_id không tồn tại trong bảng khach_hang",
      "severity": "error"
    },
    {
      "name": "fk_mon_exists",
      "query": "SELECT COUNT(*) as cnt FROM staging.mon_tbl WHERE id = ?",
      "params_from_row": ["mon_id"],
      "validation": "result[0]['cnt'] > 0 if result else False",
      "error_message": "mon_id không tồn tại trong bảng mon",
      "severity": "error"
    }
  ],
  "mon": [
    {
      "name": "fk_loai_exists",
      "query": "SELECT COUNT(*) as cnt FROM staging.loai_mon_tbl WHERE id = ?",
      "params_from_row": ["loai_id"],
      "validation": "result[0]['cnt'] > 0 if result else False",
      "error_message": "loai_id không tồn tại trong bảng loai_mon",
      "severity": "error"
    },
    {
      "name": "price_in_range",
      "query": "SELECT AVG(CAST(gia AS FLOAT)) as avg_price, MIN(CAST(gia AS FLOAT)) as min_price, MAX(CAST(gia AS FLOAT)) as max_price FROM staging.mon_tbl WHERE loai_id = ?",
      "params_from_row": ["loai_id"],
      "validation": "True",
      "error_message": "Giá món có thể không hợp lý so với trung bình loại",
      "severity": "warning"
    }
  ],
  "khach_hang": [
    {
      "name": "email_unique_in_db",
      "query": "SELECT COUNT(*) as cnt FROM staging.khach_hang_tbl WHERE email = ?",
      "params_from_row": ["email"],
      "validation": "result[0]['cnt'] == 0 if result else True",
      "error_message": "Email đã tồn tại trong database",
      "severity": "error"
    }
  ]
}
